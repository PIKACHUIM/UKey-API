
<html>
<head>
<script language="JavaScript" src="gfa_sec_lib.js">
</script>

<script>
//alert("test html js first");

//枚举证书，签名，验证签名回调函数，通过该函数对枚举证书的结果，签名结果，验证签名结果进行处理。
function callback_process_resp_msg(msg)
{
	//alert(msg);
	//json字符串转换为json对象
	var msgobj = eval('(' + msg + ')'); 
	//cert app part
	if(msgobj.msg_type == "msg_type_echo_resp")
	{
		//alert("111");
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			document.getElementById("demo1").innerHTML = JSON.stringify(msgobj.msg_body);
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_enum_certs_resp")
	{
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			//document.getElementById("demo1").innerHTML = JSON.stringify(msgobj.msg_body);
			if(0 == msgobj.msg_body.errcode)
			{
				var strUserList = msgobj.msg_body.userlist;
				pushAllDropListBox(strUserList, "gfa_certs_list");
				g_GfaSecAppObj.userlist = strUserList;
				g_GfaSecAppObj.certs = msgobj.msg_body.certs;
			}
			else
			{
				//alert(msgobj.msg_body.errcode);
				//alert(msgobj.msg_body.result);
				document.getElementById("demo1").innerHTML = msgobj.msg_body.errcode;
				document.getElementById("demo2").innerHTML = msgobj.msg_body.userlist;
				document.getElementById("demo3").innerHTML = msgobj.msg_body.certs;
			}
			
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_sign_resp")
	{
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			document.getElementById("demo1").innerHTML = JSON.stringify(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body.errcode;
			document.getElementById("demo3").innerHTML = msgobj.msg_body.result;
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_verify_resp")
	{
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			document.getElementById("demo1").innerHTML = JSON.stringify(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body.errcode;
			document.getElementById("demo3").innerHTML = msgobj.msg_body.result;
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_sign_file_resp")
	{
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			document.getElementById("demo1").innerHTML = JSON.stringify(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body.errcode;
			document.getElementById("demo3").innerHTML = msgobj.msg_body.result;
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_verify_file_resp")
	{
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			document.getElementById("demo1").innerHTML = JSON.stringify(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body.errcode;
			document.getElementById("demo3").innerHTML = msgobj.msg_body.result;
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_encrypt_resp")
	{
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			document.getElementById("demo1").innerHTML = JSON.stringify(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body.errcode;
			document.getElementById("demo3").innerHTML = msgobj.msg_body.result;
			document.getElementById("demo4").innerHTML = msgobj.msg_body.cipher_key;
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_decrypt_resp")
	{
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			document.getElementById("demo1").innerHTML = JSON.stringify(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body.errcode;
			document.getElementById("demo3").innerHTML = msgobj.msg_body.result;
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_encrypt_file_resp")
	{
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			document.getElementById("demo1").innerHTML = JSON.stringify(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body.errcode;
			document.getElementById("demo3").innerHTML = msgobj.msg_body.result;
			document.getElementById("demo4").innerHTML = msgobj.msg_body.cipher_key;
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_decrypt_file_resp")
	{
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			document.getElementById("demo1").innerHTML = JSON.stringify(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body.errcode;
			document.getElementById("demo3").innerHTML = msgobj.msg_body.result;
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_exit_browser_resp")
	{
		alert(JSON.stringify(msgobj.msg_body));
	}
	//cert make part
	else if (msgobj.msg_type == "msg_type_enum_devices_resp")
	{
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			//document.getElementById("demo1").innerHTML = JSON.stringify(msgobj.msg_body);
			if(0 == msgobj.msg_body.errcode)
			{
				var strDevList = msgobj.msg_body.devlist;
				pushAllDropListBox(strDevList, "gfa_devices_list");
				g_GfaSecAppObj.devlist = strDevList;
				g_GfaSecAppObj.devices = msgobj.msg_body.devices;
			}
			else
			{
				//alert(msgobj.msg_body.errcode);
				//alert(msgobj.msg_body.result);
				document.getElementById("demo1").innerHTML = msgobj.msg_body.errcode;
				document.getElementById("demo2").innerHTML = msgobj.msg_body.devlist;
				document.getElementById("demo3").innerHTML = msgobj.msg_body.devices;
			}
			
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_enum_apps_resp")
	{
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			//document.getElementById("demo1").innerHTML = JSON.stringify(msgobj.msg_body);
			if(0 == msgobj.msg_body.errcode)
			{
				var strAppList = msgobj.msg_body.applist;
				pushAllDropListBox(strAppList, "gfa_apps_list");
				g_GfaSecAppObj.applist = strAppList;
				g_GfaSecAppObj.apps = msgobj.msg_body.apps;
			}
			else
			{
				//alert(msgobj.msg_body.errcode);
				//alert(msgobj.msg_body.result);
				document.getElementById("demo1").innerHTML = msgobj.msg_body.errcode;
				document.getElementById("demo2").innerHTML = msgobj.msg_body.applist;
				document.getElementById("demo3").innerHTML = msgobj.msg_body.apps;
			}
			
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_login_app_resp")
	{
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			document.getElementById("demo1").innerHTML = JSON.stringify(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body.errcode;
			document.getElementById("demo3").innerHTML = msgobj.msg_body.result;
			document.getElementById("demo4").innerHTML = msgobj.msg_body.retry_count;
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_change_app_pin_resp")
	{
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			document.getElementById("demo1").innerHTML = JSON.stringify(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body.errcode;
			document.getElementById("demo3").innerHTML = msgobj.msg_body.result;
			document.getElementById("demo4").innerHTML = msgobj.msg_body.retry_count;
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_create_ecc_key_pair_resp")
	{
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			document.getElementById("demo1").innerHTML = JSON.stringify(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body.errcode;
			document.getElementById("demo3").innerHTML = msgobj.msg_body.ecc_cont;
			document.getElementById("demo4").innerHTML = msgobj.msg_body.ecc_pub_key;
			document.getElementById("ecc_cont").value = msgobj.msg_body.ecc_cont;
			document.getElementById("ecc_pub_key").value = msgobj.msg_body.ecc_pub_key;
			
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_create_rsa_key_pair_resp")
	{
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			document.getElementById("demo1").innerHTML = JSON.stringify(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body.errcode;
			document.getElementById("demo3").innerHTML = msgobj.msg_body.rsa_cont;
			document.getElementById("demo4").innerHTML = msgobj.msg_body.rsa_pub_key;
			document.getElementById("rsa_cont").value = msgobj.msg_body.rsa_cont;
			document.getElementById("rsa_pub_key").value = msgobj.msg_body.rsa_pub_key;
			
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_enum_conts_resp")
	{
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			//document.getElementById("demo1").innerHTML = JSON.stringify(msgobj.msg_body);
			if(0 == msgobj.msg_body.errcode)
			{
				var strContList = msgobj.msg_body.contlist;
				pushAllDropListBox(strContList, "gfa_conts_list");
				g_GfaSecAppObj.contlist = strContList;
				g_GfaSecAppObj.conts = msgobj.msg_body.conts;
			}
			else
			{
				//alert(msgobj.msg_body.errcode);
				//alert(msgobj.msg_body.result);
				document.getElementById("demo1").innerHTML = msgobj.msg_body.errcode;
				document.getElementById("demo2").innerHTML = msgobj.msg_body.applist;
				document.getElementById("demo3").innerHTML = msgobj.msg_body.apps;
			}
			
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_create_subject_dn_resp")
	{
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			document.getElementById("demo1").innerHTML = JSON.stringify(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body.errcode;
			document.getElementById("demo3").innerHTML = msgobj.msg_body.result;
			document.getElementById("subject_dn").value = msgobj.msg_body.result;
			
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_create_ecc_csr_resp")
	{
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			document.getElementById("demo1").innerHTML = JSON.stringify(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body.errcode;
			document.getElementById("demo3").innerHTML = msgobj.msg_body.result;
			document.getElementById("ecc_csr").value = msgobj.msg_body.result;
			
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_create_rsa_csr_resp")
	{
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			document.getElementById("demo1").innerHTML = JSON.stringify(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body.errcode;
			document.getElementById("demo3").innerHTML = msgobj.msg_body.result;
			document.getElementById("rsa_csr").value = msgobj.msg_body.result;
			
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_parse_p7b_cert_chain_resp")
	{
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			document.getElementById("demo1").innerHTML = JSON.stringify(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body.errcode;
			document.getElementById("demo3").innerHTML = msgobj.msg_body.result;
			document.getElementById("der_cert").value = msgobj.msg_body.result;
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_install_ecc_sign_cert_resp")
	{
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			document.getElementById("demo1").innerHTML = JSON.stringify(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body.errcode;
			document.getElementById("demo3").innerHTML = msgobj.msg_body.result;
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_del_ecc_cont_resp")
	{
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			document.getElementById("demo1").innerHTML = JSON.stringify(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body.errcode;
			document.getElementById("demo3").innerHTML = msgobj.msg_body.result;
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_install_ecc_enc_cert_resp")
	{
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			document.getElementById("demo1").innerHTML = JSON.stringify(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body.errcode;
			document.getElementById("demo3").innerHTML = msgobj.msg_body.result;
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_oth_resp")
	{
		alert("222");
	}
	else
	{
		alert("333");
		//alert(msgobj.msg_type);
		//alert(msgobj.msg_body);
	}
}

function callback_process_p11_resp_msg(msg)
{
	//alert(msg);
	//json字符串转换为json对象
	var msgobj = eval('(' + msg + ')'); 
	//p11 part
	if(msgobj.msg_type == "msg_type_echo_resp")
	{
		//alert("111");
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			document.getElementById("p11demo1").innerHTML = JSON.stringify(msgobj.msg_body);
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("p11demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_gen_secret_key_resp")
	{
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			document.getElementById("p11demo1").innerHTML = JSON.stringify(msgobj.msg_body);
			document.getElementById("p11demo2").innerHTML = msgobj.msg_body.errcode;
			document.getElementById("p11demo3").innerHTML = msgobj.msg_body.result;
			document.getElementById("secret_key").value = msgobj.msg_body.result;
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("p11demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_sym_encrypt_msg_resp")
	{
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			document.getElementById("p11demo1").innerHTML = JSON.stringify(msgobj.msg_body);
			document.getElementById("p11demo2").innerHTML = msgobj.msg_body.errcode;
			document.getElementById("p11demo3").innerHTML = msgobj.msg_body.result;
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("p11demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_sym_decrypt_msg_resp")
	{
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			document.getElementById("p11demo1").innerHTML = JSON.stringify(msgobj.msg_body);
			document.getElementById("p11demo2").innerHTML = msgobj.msg_body.errcode;
			document.getElementById("p11demo3").innerHTML = msgobj.msg_body.result;
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("p11demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_sym_encrypt_file_resp")
	{
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			document.getElementById("p11demo1").innerHTML = JSON.stringify(msgobj.msg_body);
			document.getElementById("p11demo2").innerHTML = msgobj.msg_body.errcode;
			document.getElementById("p11demo3").innerHTML = msgobj.msg_body.result;
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("p11demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_sym_decrypt_file_resp")
	{
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			document.getElementById("p11demo1").innerHTML = JSON.stringify(msgobj.msg_body);
			document.getElementById("p11demo2").innerHTML = msgobj.msg_body.errcode;
			document.getElementById("p11demo3").innerHTML = msgobj.msg_body.result;
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("p11demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_p7_encrypt_msg_resp")
	{
		if(typeof(msgobj.msg_body) == "object")
		{
			//alert(JSON.stringify(msgobj.msg_body));
			document.getElementById("p11demo1").innerHTML = JSON.stringify(msgobj.msg_body);
			document.getElementById("p11demo2").innerHTML = msgobj.msg_body.errcode;
			document.getElementById("p11demo3").innerHTML = msgobj.msg_body.result;
		}
		else
		{
			//alert(msgobj.msg_body);
			document.getElementById("p11demo2").innerHTML = msgobj.msg_body;
		}
	}
	else if (msgobj.msg_type == "msg_type_oth_resp")
	{
		alert("222");
	}
	else
	{
		alert("333");
		//alert(msgobj.msg_type);
		//alert(msgobj.msg_body);
	}
}

// 格式方法
// 公共方法
function transitionJsonToString (jsonObj, callback) {
	// 转换后的jsonObj受体对象
	var _jsonObj = null;
	// 判断传入的jsonObj对象是不是字符串，如果是字符串需要先转换为对象，再转换为字符串，这样做是为了保证转换后的字符串为双引号
	if (Object.prototype.toString.call(jsonObj) !== "[object String]") {
		try {
			_jsonObj = JSON.stringify(jsonObj);
		} catch (error) {
			// 转换失败错误信息
			console.error('您传递的json数据格式有误，请核对...');
			console.error(error);
			callback(error);
		}
	} else {
		try {
			jsonObj = jsonObj.replace(/(\')/g, '\"');
			_jsonObj = JSON.stringify(JSON.parse(jsonObj));
		} catch (error) {
			// 转换失败错误信息
			console.error('您传递的json数据格式有误，请核对...');
			console.error(error);
			callback(error);
		}
	}
	return _jsonObj;
}
// callback为数据格式化错误的时候处理函数
function formatJson (jsonObj, callback) {
	// 正则表达式匹配规则变量
	var reg = null;
	// 转换后的字符串变量
	var formatted = '';
	// 换行缩进位数
	var pad = 0;
	// 一个tab对应空格位数
	var PADDING = '    ';
	// json对象转换为字符串变量
	var jsonString = transitionJsonToString(jsonObj, callback);
	if (!jsonString) {
		return jsonString;
	}
	// 存储需要特殊处理的字符串段
	var _index = [];
	// 存储需要特殊处理的“再数组中的开始位置变量索引
	var _indexStart = null;
	// 存储需要特殊处理的“再数组中的结束位置变量索引
	var _indexEnd = null;
	// 将jsonString字符串内容通过\r\n符分割成数组
	var jsonArray = [];
    // 正则匹配到{,}符号则在两边添加回车换行
	jsonString = jsonString.replace(/([\{\}])/g, '\r\n$1\r\n');
	// 正则匹配到[,]符号则在两边添加回车换行
	jsonString = jsonString.replace(/([\[\]])/g, '\r\n$1\r\n');
	// 正则匹配到,符号则在两边添加回车换行
	jsonString = jsonString.replace(/(\,)/g, '$1\r\n');
	// 正则匹配到要超过一行的换行需要改为一行
	jsonString = jsonString.replace(/(\r\n\r\n)/g, '\r\n');
	// 正则匹配到单独处于一行的,符号时需要去掉换行，将,置于同行
	jsonString = jsonString.replace(/\r\n\,/g, ',');
	// 特殊处理双引号中的内容
	jsonArray = jsonString.split('\r\n');
	jsonArray.forEach(function (node, index) {
		// 获取当前字符串段中"的数量
		var num = node.match(/\"/g) ? node.match(/\"/g).length : 0;
		// 判断num是否为奇数来确定是否需要特殊处理
		if (num % 2 && !_indexStart) {
			_indexStart = index
		}
		if (num % 2 && _indexStart && _indexStart != index) {
			_indexEnd = index
		}
		// 将需要特殊处理的字符串段的其实位置和结束位置信息存入，并对应重置开始时和结束变量
		if (_indexStart && _indexEnd) {
			_index.push({
				start: _indexStart,
				end: _indexEnd
			})
			_indexStart = null
			_indexEnd = null
		}
	})
	// 开始处理双引号中的内容，将多余的"去除
	_index.reverse().forEach(function (item, index) {
		var newArray = jsonArray.slice(item.start, item.end + 1)
		jsonArray.splice(item.start, item.end + 1 - item.start, newArray.join(''))
	})
	// 奖处理后的数组通过\r\n连接符重组为字符串
	jsonString = jsonArray.join('\r\n');
	// 将匹配到:后为回车换行加大括号替换为冒号加大括号
	jsonString = jsonString.replace(/\:\r\n\{/g, ':{');
	// 将匹配到:后为回车换行加中括号替换为冒号加中括号
	jsonString = jsonString.replace(/\:\r\n\[/g, ':[');
	// 将上述转换后的字符串再次以\r\n分割成数组
	jsonArray = jsonString.split('\r\n');
    // 将转换完成的字符串根据PADDING值来组合成最终的形态
    jsonArray.forEach(function (item, index) {
		console.log(item)
    	var i = 0;
    	// 表示缩进的位数，以tab作为计数单位
		var indent = 0;
		// 表示缩进的位数，以空格作为计数单位
		var padding = '';
		if (item.match(/\{$/) || item.match(/\[$/)) {
			// 匹配到以{和[结尾的时候indent加1
			indent += 1
		} else if (item.match(/\}$/) || item.match(/\]$/) || item.match(/\},$/) || item.match(/\],$/)) {
			// 匹配到以}和]结尾的时候indent减1
			if (pad !== 0) {
				pad -= 1
			}
        } else {
            indent = 0
        }
        for (i = 0; i < pad; i++) {
            padding += PADDING
        }
        formatted += padding + item + '\r\n'
		pad += indent
   	})
	// 返回的数据需要去除两边的空格
	return formatted.trim();
}

//该部分主要对国富安js库进行初始化，初始化全局对象g_GfaSecAppObj
g_GfaSecAppObj.Init(callback_process_resp_msg);
g_GfaSecAppObj.Init2();

</script>

</head>
<body>
<p> 远程方法调用示例 </p>
方法名字：<select size="1" name="skf_methods_list" id="skf_methods_list" style="width:300px"></select>
<button type="button" onClick="enum_methods_fun()" id="enum_methods"> 枚举注册方法 </button>

<br><br>
方法参数：<textarea name="params" id="params" style="width:300px;height:100px;">[]</textarea>
<button type="button" onClick="syn_call_method_fun()" id="syn_call_method"> 同步调用方法 </button>

<br><br>
返回结果：<textarea name="return" id="return" style="width:300px;height:500px;"></textarea>

<p> P11接口证书应用示例 </p>
<p id="p11demo1"></p>
<p id="p11demo2"></p>
<p id="p11demo3"></p>
<p id="p11demo4"></p>
<p id="p11demo5"></p>
对称密钥：<input name="secret_key" id="secret_key" style="width:300px"></input>
<br><br>
<button type="button" onClick="syn_echo_fun()" id="syn_echo"> syn_echo </button>
<button type="button" onClick="syn_echo_fun_2()" id="syn_echo_2"> syn_echo_2 </button>
<button type="button" onClick="syn_gen_secret_key_fun()" id="syn_gen_secret_key"> 产生对称密钥 </button>
<button type="button" onClick="syn_sym_encrypt_msg_fun()" id="syn_sym_encrypt_msg"> 对称加密消息 </button>
<button type="button" onClick="syn_sym_decrypt_msg_fun()" id="syn_sym_decrypt_msg"> 对称解密消息 </button>
<button type="button" onClick="syn_sym_encrypt_file_fun()" id="syn_sym_encrypt_file"> 对称加密文件 </button>
<button type="button" onClick="syn_sym_decrypt_file_fun()" id="syn_sym_decrypt_file"> 对称解密文件 </button>
<button type="button" onClick="syn_p7_encrypt_msg_fun()" id="syn_p7_encrypt_msg"> P7加密消息 </button>

<p> 证书应用示例 </p>
<p id="demo1"></p>
<p id="demo2"></p>
<p id="demo3"></p>
<p id="demo4"></p>
<p id="demo5"></p>
<p id="demo6"></p>
<p id="demo7"></p>
<p id="demo8"></p>
<p id="demo9"></p>
<p id="demo10"></p>
<p id="demo11"></p>
<p id="demo12"></p>
<p id="demo13"></p>
<p id="demo14"></p>
<p id="demo15"></p>
<select size="1" name="gfa_certs_list" id="gfa_certs_list" style="width:300px"></select>
<br><br>
<button type="button" onClick="echo_fun()" id="echo"> echo </button>
<button type="button" onClick="enum_certs_fun()" id="enum_certs"> 枚举证书 </button>
<button type="button" onClick="get_cert_info_fun()" id="get_cert_info"> 获取证书属性 </button>
<button type="button" onClick="login_fun()" id="login"> 登陆 </button>
<button type="button" onClick="change_pass_fun()" id="change_pass"> 修改pin码 </button>
<button type="button" onClick="sign_fun()" id="sign"> 签名</button>
<button type="button" onClick="verify_fun()" id="verify"> 验证</button>
<button type="button" onClick="sign_file_fun()" id="sign_file"> 签名文件</button>
<button type="button" onClick="verify_file_fun()" id="verify_file"> 验证文件签名</button>
<button type="button" onClick="encrypt_fun()" id="encrypt"> 加密</button>
<button type="button" onClick="decrypt_fun()" id="decrypt"> 解密</button>
<button type="button" onClick="encrypt_file_fun()" id="encrypt_file"> 加密文件</button>
<button type="button" onClick="decrypt_file_fun()" id="decrypt_file"> 解密文件</button>
<button type="button" onClick="exit_browser_fun()" id="exit_browser"> 退出浏览器 </button>

<p> 证书制作示例 </p>
<select size="1" name="gfa_devices_list" id="gfa_devices_list" style="width:300px"></select>
<button type="button" onClick="enum_devices_fun()" id="enum_devices"> 枚举设备 </button>
<br><br>
<select size="1" name="gfa_apps_list" id="gfa_apps_list" style="width:300px"></select>
<button type="button" onClick="enum_apps_fun()" id="enum_apps"> 枚举应用 </button>
<br><br>
<input name="app_pass" id="app_pass" value="12345678" type="password" style="width:300px"></input>
<button type="button" onClick="login_app_fun()" id="login_app"> 登陆应用 </button>
<br><br>
<input name="ecc_cont" id="ecc_cont" style="width:300px"></input>
<textarea name="ecc_pub_key" id="ecc_pub_key" style="width:300px"></textarea>
<button type="button" onClick="create_ecc_key_pair_fun()" id="create_ecc_key_pair"> 创建ECC密钥对 </button>
<br><br>
<input name="rsa_cont" id="rsa_cont" style="width:300px"></input>
<textarea name="rsa_pub_key" id="rsa_pub_key" style="width:300px"></textarea>
<button type="button" onClick="create_rsa_key_pair_fun()" id="create_rsa_key_pair"> 创建RSA密钥对 </button>
<br><br>
<select size="1" name="gfa_conts_list" id="gfa_conts_list" style="width:300px"></select>
<button type="button" onClick="enum_conts_fun()" id="enum_conts"> 枚举容器 </button>
<button type="button" onClick="del_cont_fun()" id="del_cont"> 删除容器 </button>
<button type="button" onClick="copy_cont_fun()" id="copy_cont"> 复制容器 </button>
<br><br>
电子邮件：<input name="email" id="email" value="gfa@ec.com.cn" style="width:100px"></input>
公共名字：<input name="cn" id="cn" value="www.gfa.com.cn" style="width:100px"></input>
组织单位：<input name="ou" id="ou" value="gfa" style="width:100px"></input>
组织：<input name="o" id="o" value="ciecc" style="width:100px"></input>
城市：<input name="l" id="l" value="daxing" style="width:100px"></input>
省：<input name="st" id="st" value="beijing" style="width:100px"></input>
国家：<input name="c" id="c" value="CN" style="width:100px"></input>
<br><br>
<input name="subject_dn" id="subject_dn" style="width:600px"></input>
<button type="button" onClick="create_subject_dn_fun()" id="create_subject_dn"> 创建主题DN </button>
<button type="button" onClick="reverse_dn_fun()" id="reverse_dn"> 反序主题DN（当/C=CN开头时，需要反序） </button>
<button type="button" onClick="transfer_dn_fun()" id="transfer_dn"> transfer主题DN（当以，为风格主题时，需要转换） </button>

<br><br>
<textarea name="ecc_csr" id="ecc_csr" style="width:600px"></textarea>
<button type="button" onClick="create_ecc_csr_fun()" id="create_ecc_csr"> 创建ECC证书请求 </button>

<br><br>
<textarea name="rsa_csr" id="rsa_csr" style="width:600px"></textarea>
<button type="button" onClick="create_rsa_csr_fun()" id="create_rsa_csr"> 创建RSA证书请求 </button>

<br><br>
P7b证书链：<textarea name="p7b_cert_chain" id="p7b_cert_chain" style="width:300px"></textarea>
叶子证书：<textarea name="der_cert" id="der_cert" style="width:300px"></textarea>
<button type="button" onClick="parse_p7b_cert_chain_fun()" id="parse_p7b_cert_chain"> 解析P7B证书链 </button>

<br><br>
<button type="button" onClick="del_cert_ecc_cont_fun()" id="del_cert_ecc_cont"> 删除证书ECC容器 </button>
是否更新密钥对：<input type="checkbox" name="is_key_pair_update" id="is_key_pair_update">

<br><br>
签名证书：<textarea name="ecc_sign_cert" id="ecc_sign_cert" style="width:300px"></textarea>
<button type="button" onClick="install_ecc_sign_cert_fun()" id="install_ecc_sign_cert"> 安装ECC签名证书 </button>
<button type="button" onClick="update_ecc_sign_cert_fun()" id="update_ecc_sign_cert"> 更新ECC签名证书 </button>

<br><br>
加密证书：<textarea name="ecc_enc_cert" id="ecc_enc_cert" style="width:300px"></textarea>
加密私钥密文：<textarea name="private_key_ciper" id="private_key_ciper" style="width:300px"></textarea>
<button type="button" onClick="install_ecc_enc_cert_fun()" id="install_ecc_enc_cert"> 安装ECC加密证书 </button>
<button type="button" onClick="update_ecc_enc_cert_fun()" id="update_ecc_enc_cert"> 更新ECC加密证书 </button>
<script>
	//alert("test html js second");
//rpc part
//枚举方法
/*
function enum_methods_fun() {
	var method = "EnumMethod";
	var params = "{}";
	var ret = g_GfaSecAppObj.SYN_CallMethod(method, params);
	ret.then(value=>{
			//alert(value);
			var valueobj=JSON.parse(value);
			//alert(valueobj.result.method_list);
			var strMethodsList = valueobj.result.method_list;
			pushAllDropListBox(strMethodsList, "skf_methods_list");
		});
		
		
	
}
function syn_call_method_fun()
{
	var methodSelect = document.getElementById("skf_methods_list");
	var method = methodSelect.value;
	//alert(method);
	
	var params = document.getElementById("params").value;
	//alert(params);
	
	var ret = g_GfaSecAppObj.SYN_CallMethod(method, params);
	ret.then(value=>{
			//alert(value);
			//document.getElementById("return").value = value;
			document.getElementById("return").value = formatJson(value, alert);
		});
}
*/

function enum_methods_fun() {
	var method = "EnumMethod";
	var params = "{}";
	var ret = g_GfaSecAppObj.SYN_CallMethod2(method, params);
	//alert(ret);
	var valueobj=JSON.parse(ret);
	//alert(valueobj.result.method_list);
	var strMethodsList = valueobj.result.method_list;
	pushAllDropListBox(strMethodsList, "skf_methods_list");
}
function syn_call_method_fun()
{
	var methodSelect = document.getElementById("skf_methods_list");
	var method = methodSelect.value;
	//alert(method);
	
	var params = document.getElementById("params").value;
	//alert(params);
	
	var ret = g_GfaSecAppObj.SYN_CallMethod2(method, params);
	//alert(ret);
	//document.getElementById("return").value = ret;
	document.getElementById("return").value = formatJson(ret, alert);
}

//p11 part
function syn_echo_fun() {
	/*
	var indata = {
									"para1" : "111", 
									"para2" : ["array1", "array2", "array3"],
									"para3" : 
									{
										"key1" : "aaa",
										"key2" : "bbb"
									}
								};
	*/
	var indata = "i am a simple string.我是汉字。同步调用。";
	var ret = g_GfaSecAppObj.SYN_EchoFun(indata);
	ret.then(value=>{
			//alert(value);
			callback_process_p11_resp_msg(value);
		});
}

function syn_echo_fun_2() {
	/*
	var indata = {
									"para1" : "111", 
									"para2" : ["array1", "array2", "array3"],
									"para3" : 
									{
										"key1" : "aaa",
										"key2" : "bbb"
									}
								};
	*/
	var indata = "i am a simple string.我是汉字。同步调用2。";
	var ret = g_GfaSecAppObj.SYN_EchoFun(indata);
	ret.then(value=>{
			//alert(value);
			callback_process_p11_resp_msg(value);
		});
}

function syn_gen_secret_key_fun() {
	var secretKeyLen = 16;//3des三倍长密钥长度24 sm4密钥长度16
	var ret = g_GfaSecAppObj.SYN_GenSecretKey(secretKeyLen);
	ret.then(value=>{
			//alert(value);
			callback_process_p11_resp_msg(value);
		});
}

function syn_sym_encrypt_msg_fun() {
	
	var secretKey = document.getElementById("secret_key").value;
	str = new String(secretKey);
	var secretKeyLen = str.length;
	
	var indata = "this is plain text.";
	str = new String(indata);
	var indataLen = str.length;
	var ret = g_GfaSecAppObj.SYN_SymEncryptMsg(secretKey, secretKeyLen, indata, indataLen);
	ret.then(value=>{
			//alert(value);
			callback_process_p11_resp_msg(value);
		});
}

function syn_sym_decrypt_msg_fun() {
	
	var secretKey = document.getElementById("secret_key").value;
	str = new String(secretKey);
	var secretKeyLen = str.length;
	
	var indata = document.getElementById("p11demo3").innerHTML;
	str = new String(indata);
	var indataLen = str.length;
	var ret = g_GfaSecAppObj.SYN_SymDecryptMsg(secretKey, secretKeyLen, indata, indataLen);
	ret.then(value=>{
			//alert(value);
			callback_process_p11_resp_msg(value);
		});
}

function syn_sym_encrypt_file_fun() {
	
	var secretKey = document.getElementById("secret_key").value;
	str = new String(secretKey);
	var secretKeyLen = str.length;
	
	//var inFileName = "/root/gfa_app_demo.html";
	//var outFileName = "/root/gfa_app_demo.html.enc";
	var inFileName = "E:\\work\\gfa\\websocketpp-master\\build\\bin\\Debug\\xxx.doc";
	var outFileName = "E:\\work\\gfa\\websocketpp-master\\build\\bin\\Debug\\xxx.doc.enc";
	var ret = g_GfaSecAppObj.SYN_SymEncryptFile(secretKey, secretKeyLen, inFileName, outFileName);
	ret.then(value=>{
			//alert(value);
			callback_process_p11_resp_msg(value);
		});
}

function syn_sym_decrypt_file_fun() {
	
	var secretKey = document.getElementById("secret_key").value;
	str = new String(secretKey);
	var secretKeyLen = str.length;
	
	//var inFileName = "/root/gfa_app_demo.html.enc";
	//var outFileName = "/root/gfa_app_demo.html.enc.raw";
	var inFileName = "E:\\work\\gfa\\websocketpp-master\\build\\bin\\Debug\\xxx.doc.enc";
	var outFileName = "E:\\work\\gfa\\websocketpp-master\\build\\bin\\Debug\\xxx.doc.enc.doc";
	var ret = g_GfaSecAppObj.SYN_SymDecryptFile(secretKey, secretKeyLen, inFileName, outFileName);
	ret.then(value=>{
			//alert(value);
			callback_process_p11_resp_msg(value);
		});
}

function syn_p7_encrypt_msg_fun() {
/*
	var encCert = "-----BEGIN CERTIFICATE-----\r\n" + 
"MIICNTCCAdygAwIBAgIGAW9ADHelMAoGCCqGSM49BAMCMEIxCzAJBgNVBAYTAkNO\r\n" + 
"MQwwCgYDVQQKDANHRkExJTAjBgNVBAMMHFNNMiBJbnRlcm1lZGlhdGUgQ0EgRk9S\r\n" + 
"IFRFU1QwHhcNMTkxMjI2MDIzMjMxWhcNMjQxMjI2MDIzMjM2WjBPMQswCQYDVQQG\r\n" + 
"EwJDTjELMAkGA1UEBwwCQkoxDjAMBgNVBAoMBUNJRUNDMQwwCgYDVQQLDANHRkEx\r\n" + 
"FTATBgNVBAMMDFRTQSBTTTIgQ2VydDBZMBMGByqGSM49AgEGCCqBHM9VAYItA0IA\r\n" + 
"BKtlhBlM1SelMBIMW5Ci1wLUoQfQ/zitSEvZDMk52g70k6EyyvIlRMurh5JG0j55\r\n" + 
"vzC2/YVN9BzOeeHsgn62Dz6jgbAwga0wZwYDVR0jBGAwXoAUR1ck75a08vB14Med\r\n" + 
"soRhY6WV+lyhPqQ8MDoxCzAJBgNVBAYTAkNOMQwwCgYDVQQKDANHRkExHTAbBgNV\r\n" + 
"BAMMFFNNMiBST09UIENBIEZPUiBURVNUggYBbm5h+vEwHQYDVR0OBBYEFHPwyoZ5\r\n" + 
"+XDx1UABDJoHuVc+sPMXMAsGA1UdDwQEAwIGwDAWBgNVHSUBAf8EDDAKBggrBgEF\r\n" + 
"BQcDCDAKBggqhkjOPQQDAgNHADBEAiAyi6wsKVSsYYu5Gw4W5qP6bt78Zt22z2yo\r\n" + 
"ao5x0SCcIAIgNsiCdfVwntuMyPeZ7g7h/hRmcOcmrTn5b4OvNELssDc=\r\n" + 
"-----END CERTIFICATE-----\r\n";
*/
var encCert = "-----BEGIN CERTIFICATE-----\r\n" + 
"MIICIjCCAcigAwIBAgIGAW5uYfrxMAoGCCqBHM9VAYN1MDoxCzAJBgNVBAYTAkNO\r\n" + 
"MQwwCgYDVQQKDANHRkExHTAbBgNVBAMMFFNNMiBST09UIENBIEZPUiBURVNUMB4X\r\n" + 
"DTE5MTExNTA5MjU0MFoXDTI0MTExNTA5MjU0NVowQjELMAkGA1UEBhMCQ04xDDAK\r\n" + 
"BgNVBAoMA0dGQTElMCMGA1UEAwwcU00yIEludGVybWVkaWF0ZSBDQSBGT1IgVEVT\r\n" + 
"VDBZMBMGByqGSM49AgEGCCqBHM9VAYItA0IABEU5UyV9aC1RcvgkBzHmJsKM8trO\r\n" + 
"9lw6UeUaZPmuW2NfIPxaZDiWWhHiH7wLYGkByFnTOWSy8wvIUXyr40DB2kKjgbEw\r\n" + 
"ga4waQYDVR0jBGIwYIAUwzud7kw/LITVqJHJpclH1cvNzX2hPqQ8MDoxCzAJBgNV\r\n" + 
"BAYTAkNOMQwwCgYDVQQKDANHRkExHTAbBgNVBAMMFFNNMiBST09UIENBIEZPUiBU\r\n" + 
"RVNUgghp4v7AFwrGezAdBgNVHQ4EFgQUR1ck75a08vB14MedsoRhY6WV+lwwEgYD\r\n" + 
"VR0TAQH/BAgwBgEB/wIBAjAOBgNVHQ8BAf8EBAMCAYYwCgYIKoEcz1UBg3UDSAAw\r\n" + 
"RQIhAO9esHFjt3Z/WAMbFUxBSqm/ADRlBFeLoQut+kR+HommAiB61DAqfcBd1HKN\r\n" + 
"uG9TNNd8L3yfPZhGkEwVX9LCjzqP4g==\r\n" + 
"-----END CERTIFICATE-----\r\n";

/*
var encCert = "-----BEGIN CERTIFICATE-----\r\n" + 
"MIID4jCCAsqgAwIBAgIGAW/B7I+BMA0GCSqGSIb3DQEBCwUAMEIxCzAJBgNVBAYT\r\n" + 
"AkNOMQwwCgYDVQQKDANHRkExJTAjBgNVBAMMHFJTQSBJbnRlcm1lZGlhdGUgQ0Eg\r\n" + 
"Rk9SIFRFU1QwHhcNMjAwMTIwMDc0ODE4WhcNMjUwMTIwMDc0ODIzWjBGMQswCQYD\r\n" + 
"VQQGEwJDTjENMAsGA1UECgwEVGVzdDEQMA4GA1UECAwHQmVpSmluZzEWMBQGA1UE\r\n" + 
"AwwNc3NsIHRlc3QgY2VydDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEB\r\n" + 
"AJvFcISXa86iU8wlTvKiUu4Rsl0pOZfPwFBf7QcUOdLGd+6+hEmD5Rjru7SdT9ml\r\n" + 
"Sb5kvgiK8Ys+KY9l4g1tv3WGJvWAbbSuVTERuCyXRsx/2rpWVr1LRJFcVa7tVBoK\r\n" + 
"bOZuTaCADQbb7ELkh41IueBJ42bBOBmZTx9HoR+bylo7sx7q3RbEa00wHyiQ3RmU\r\n" + 
"3+PL1vDppqd/yUX2kRKqLYxQuDZVyrFmCd7zHQychPQoBKEOU8+TOCzanuQs6XIj\r\n" + 
"8hMTLrcMYsXwiL30sWZh3BLIR2aSKcksg/USkJq12F9mZYJGZM5+rMwKmpfNU5ym\r\n" + 
"pDCc/aR62dJZx37XnqGRykMCAwEAAaOB2TCB1jBnBgNVHSMEYDBegBQ+HWwy+yra\r\n" + 
"wZ41IIvwoyV8elx55KE+pDwwOjELMAkGA1UEBhMCQ04xDDAKBgNVBAoMA0dGQTEd\r\n" + 
"MBsGA1UEAwwUUlNBIFJPT1QgQ0EgRk9SIFRFU1SCBgFvu9RtCzAdBgNVHQ4EFgQU\r\n" + 
"C2snUb1kHcaWIzbwlXMLooZ9oeYwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUF\r\n" + 
"BwMCMAkGA1UdEwQCMAAwEgYDVR0RAQH/BAgwBocE01gZhzAOBgNVHQ8BAf8EBAMC\r\n" + 
"BaAwDQYJKoZIhvcNAQELBQADggEBALZjQPS3zZG6mIXpXl34APaQpLeSqMKLiweL\r\n" + 
"4EarC1QENk5Lq8vY9znrHEKNAINEJTxA2fKFMmSTwZRdm99/1Kfm2MiI/cPrw3/3\r\n" + 
"1RpZac1cm8BoHYQXa2GCG5c54Z1NiQ88P/rib/KQx6e3Ayj8pT8oERosy638OZXC\r\n" + 
"bOv/qk6ZG1qERwErnJhENIVHwuuvwGpRAb5UIVceJcpenwewXr8xWz5557DUQ3nP\r\n" + 
"ukEQ39wrLEQ1Gwcrg5mJhJ2C1c+R5iwfjAPqfQ9ejuqMgiRudfkRJ2PD3BaAgn8m\r\n" + 
"Y2ZxJTbXVX7ErM71ESshfH1gLBJQGuvdAIuCamTYzfMX24w2tL8=\r\n" + 
"-----END CERTIFICATE-----\r\n";
*/
	str = new String(encCert);
	var encCertLen = str.length;
	
	var indata = "this is plain text.";
	str = new String(indata);
	var indataLen = str.length;
	var ret = g_GfaSecAppObj.SYN_P7EncryptMsg(encCert, encCertLen, indata, indataLen);
	ret.then(value=>{
			//alert(value);
			callback_process_p11_resp_msg(value);
		});
}

//cert app part
//回显	
function echo_fun() {
	/*
	var indata = {
									"para1" : "111", 
									"para2" : ["array1", "array2", "array3"],
									"para3" : 
									{
										"key1" : "aaa",
										"key2" : "bbb"
									}
								};
	*/
	var indata = "i am a simple string.我是汉字。异步调用。";
	g_GfaSecAppObj.EchoFun(indata);
}

//枚举证书
function enum_certs_fun() {
	var certType = CERT_TYPE_ALL;
	g_GfaSecAppObj.EnumCerts(certType);
}

//时间格式转换函数
function show_time(time){   
	var year = time.getFullYear();       //年
  var month = time.getMonth() + 1;     //月
  var day = time.getDate();            //日
 
  var hh = time.getHours();            //时
  var mm = time.getMinutes();          //分
  var ss = time.getSeconds();
 
  var clock = year + "-";
 
  if(month < 10)
      clock += "0";
 
  clock += month + "-";
 
  if(day < 10)
      clock += "0";
     
  clock += day + " ";
 
  if(hh < 10)
      clock += "0";
     
  clock += hh + ":";
  
  if (mm < 10) clock += '0'; 
  clock += mm + ":"; 
  
  if(ss < 10)
      clock += "0";
  
  clock += ss;
  return(clock); 
}

//时间对象转换函数
function time_convert(dVal){
	var oDate = new Date();
	var localOffset = oDate.getTimezoneOffset() * 60000;//系统时区偏移
	oDate.setTime((dVal - 25569) * 24 * 3600 * 1000 + localOffset);
			
	return oDate;
}

//获取证书的属性
function get_cert_info_fun() {
	//time =  new Date();
	//alert(show_time(time));
	var  myselect=document.getElementById("gfa_certs_list");	
	var cert = g_GfaSecAppObj.certs[myselect.selectedIndex];
	document.getElementById("demo1").innerHTML = cert.cn;
	document.getElementById("demo2").innerHTML = cert.subject;
	document.getElementById("demo3").innerHTML = cert.issuer;
	document.getElementById("demo4").innerHTML = cert.csp;
	document.getElementById("demo5").innerHTML = cert.kc;
	document.getElementById("demo6").innerHTML = cert.sn;
	//document.getElementById("demo7").innerHTML = show_time(time_convert(cert.from));
	//document.getElementById("demo8").innerHTML = show_time(time_convert(cert.to));
	document.getElementById("demo7").innerHTML = cert.from;
	document.getElementById("demo8").innerHTML = cert.to;
	document.getElementById("demo9").innerHTML = cert.usage;
	document.getElementById("demo10").innerHTML = cert.keyspec;
	document.getElementById("demo11").innerHTML = cert.keytype;
	document.getElementById("demo12").innerHTML = cert.crl;
	document.getElementById("demo13").innerHTML = cert.b64cert;
	document.getElementById("demo14").innerHTML = cert.app_name;
	document.getElementById("demo15").innerHTML = cert.dev_name;
}

//登陆
function login_fun() {
	var  myselect=document.getElementById("gfa_certs_list");	
	var cert = g_GfaSecAppObj.certs[myselect.selectedIndex];
	
	var devName = cert.dev_name;
	var appName = cert.app_name;
	var appPass = "12345678";
	g_GfaSecAppObj.LoginApp(devName, appName, appPass);
}
//修改pin码
function change_pass_fun() {
	var  myselect=document.getElementById("gfa_certs_list");	
	var cert = g_GfaSecAppObj.certs[myselect.selectedIndex];
	
	var devName = cert.dev_name;
	var appName = cert.app_name;
	var appOldPass = "12345678";
	var appNewPass = "12345678";
	g_GfaSecAppObj.ChangeAppPin(devName, appName, appOldPass, appNewPass);
}


//普通签名
function sign_fun() {
	var  myselect=document.getElementById("gfa_certs_list");	
	var cert = g_GfaSecAppObj.certs[myselect.selectedIndex];
	
	var devName = cert.dev_name;
	var appName = cert.app_name;
	var kc = cert.kc;
	var indata = "this is plain text.";
	str = new String(indata);
	var indataLen = str.length;
	
	g_GfaSecAppObj.Sign(devName, appName, kc, indata, indataLen);
}

//验证普通签名
function verify_fun() {
	var  myselect=document.getElementById("gfa_certs_list");	
	var cert = g_GfaSecAppObj.certs[myselect.selectedIndex];
	
	var devName = cert.dev_name;
	var appName = cert.app_name;
	var kc = cert.kc;
	var indata = "this is plain text.";
	str = new String(indata);
	var indataLen = str.length;
	var signValue = document.getElementById("demo3").innerHTML;
	str = new String(signValue);
	var signValueLen = str.length;
	g_GfaSecAppObj.Verify(devName, appName, kc, indata, indataLen, signValue, signValueLen);
	
}

//文件签名
function sign_file_fun() {
	var  myselect=document.getElementById("gfa_certs_list");	
	var cert = g_GfaSecAppObj.certs[myselect.selectedIndex];
	
	var devName = cert.dev_name;
	var appName = cert.app_name;
	var kc = cert.kc;
	//var indata = "/root/gfa_app_demo.html";
	var indata = "E:\\work\\gfa\\websocketpp-master\\build\\bin\\Debug\\xxx.doc";
	str = new String(indata);
	var indataLen = str.length;
	
	g_GfaSecAppObj.SignFile(devName, appName, kc, indata, indataLen);
}

//验证文件签名
function verify_file_fun() {
	var  myselect=document.getElementById("gfa_certs_list");	
	var cert = g_GfaSecAppObj.certs[myselect.selectedIndex];
	
	var devName = cert.dev_name;
	var appName = cert.app_name;
	var kc = cert.kc;
	//var indata = "/root/gfa_app_demo.html";
	var indata = "E:\\work\\gfa\\websocketpp-master\\build\\bin\\Debug\\xxx.doc";
	str = new String(indata);
	var indataLen = str.length;
	var signValue = document.getElementById("demo3").innerHTML;
	str = new String(signValue);
	var signValueLen = str.length;
	g_GfaSecAppObj.VerifyFile(devName, appName, kc, indata, indataLen, signValue, signValueLen);
	
}

//普通加密
function encrypt_fun() {
	var  myselect=document.getElementById("gfa_certs_list");	
	var cert = g_GfaSecAppObj.certs[myselect.selectedIndex];
	
	var devName = cert.dev_name;
	var appName = cert.app_name;
	var kc = cert.kc;
	var indata = "1234567812345678abcdef";
	str = new String(indata);
	var indataLen = str.length;
	
	g_GfaSecAppObj.Encrypt(devName, appName, kc, indata, indataLen);
}
//普通解密
function decrypt_fun() {
	var  myselect=document.getElementById("gfa_certs_list");	
	var cert = g_GfaSecAppObj.certs[myselect.selectedIndex];
	
	var devName = cert.dev_name;
	var appName = cert.app_name;
	var kc = cert.kc;
	var cipherValue = document.getElementById("demo3").innerHTML;
	
	str = new String(cipherValue);
	var cipherValueLen = str.length;
	
	var cipherKey = document.getElementById("demo4").innerHTML;
	str = new String(cipherKey);
	var cipherKeyLen = str.length;
	g_GfaSecAppObj.Decrypt(devName, appName, kc, cipherValue, cipherValueLen, cipherKey, cipherKeyLen);
	
	
}
//文件加密
function encrypt_file_fun() {
	var  myselect=document.getElementById("gfa_certs_list");	
	var cert = g_GfaSecAppObj.certs[myselect.selectedIndex];
	
	var devName = cert.dev_name;
	var appName = cert.app_name;
	var kc = cert.kc;
	var inFileName = "E:\\work\\gfa\\websocketpp-master\\build\\bin\\Debug\\xxx.doc";
	var outFileName = "E:\\work\\gfa\\websocketpp-master\\build\\bin\\Debug\\xxx.doc.enc";
	
	
	g_GfaSecAppObj.EncryptFile(devName, appName, kc, inFileName, outFileName);
}
//文件解密
function decrypt_file_fun() {
	var  myselect=document.getElementById("gfa_certs_list");	
	var cert = g_GfaSecAppObj.certs[myselect.selectedIndex];
	
	var devName = cert.dev_name;
	var appName = cert.app_name;
	var kc = cert.kc;
	var inFileName = "E:\\work\\gfa\\websocketpp-master\\build\\bin\\Debug\\xxx.doc.enc";
	var outFileName = "E:\\work\\gfa\\websocketpp-master\\build\\bin\\Debug\\xxx.doc.enc.raw.doc";
	
	var cipherKey = document.getElementById("demo4").innerHTML;
	str = new String(cipherKey);
	var cipherKeyLen = str.length;
	g_GfaSecAppObj.DecryptFile(devName, appName, kc, inFileName, outFileName, cipherKey, cipherKeyLen);
	
	
}

//退出浏览器
function exit_browser_fun() {
	var browserType = 1; //1UOS
	g_GfaSecAppObj.ExitBrowser(browserType);
}

//cert make part
//枚举设备
function enum_devices_fun() {
	var devType = 1; //1在线设备 0驱动支持的设备 
	g_GfaSecAppObj.EnumDevices(devType);
	
}
//枚举应用
function enum_apps_fun() {
	var  myselect=document.getElementById("gfa_devices_list");	
	var devName = myselect.value;
	alert(devName);
	g_GfaSecAppObj.EnumApps(devName);
	
}
//登陆应用
function login_app_fun() {
	var  devSelect=document.getElementById("gfa_devices_list");	
	var devName = devSelect.value;
	//alert(devName);
	var  appSelect=document.getElementById("gfa_apps_list");	
	var appName = appSelect.value;
	//alert(appName);
	var  appPassInput=document.getElementById("app_pass");	
	var appPass = appPassInput.value;
	alert(devName + "---" + appName + "---" + appPass);
	g_GfaSecAppObj.LoginApp(devName, appName, appPass);
	
}
//创建ECC密钥对
function create_ecc_key_pair_fun() {
	var  devSelect=document.getElementById("gfa_devices_list");	
	var devName = devSelect.value;
	//alert(devName);
	var  appSelect=document.getElementById("gfa_apps_list");	
	var appName = appSelect.value;
	//alert(appName);
	var  appPassInput=document.getElementById("app_pass");	
	var appPass = appPassInput.value;
	alert(devName + "---" + appName + "---" + appPass);
	g_GfaSecAppObj.CreateEccKeyPair(devName, appName, appPass);
	
}

//创建RSA密钥对
function create_rsa_key_pair_fun() {
	var  devSelect=document.getElementById("gfa_devices_list");	
	var devName = devSelect.value;
	//alert(devName);
	var  appSelect=document.getElementById("gfa_apps_list");	
	var appName = appSelect.value;
	//alert(appName);
	var  appPassInput=document.getElementById("app_pass");	
	var appPass = appPassInput.value;
	alert(devName + "---" + appName + "---" + appPass);
	g_GfaSecAppObj.CreateRsaKeyPair(devName, appName, appPass);
	
}

//枚举容器
function enum_conts_fun() {
	var  devSelect=document.getElementById("gfa_devices_list");	
	var devName = devSelect.value;
	//alert(devName);
	var  appSelect=document.getElementById("gfa_apps_list");	
	var appName = appSelect.value;
	//alert(appName);
	g_GfaSecAppObj.EnumConts(devName, appName);
	
}
//删除容器
function del_cont_fun() {
	
	var  devSelect=document.getElementById("gfa_devices_list");	
	var devName = devSelect.value;
	//alert(devName);
	var  appSelect=document.getElementById("gfa_apps_list");	
	var appName = appSelect.value;
	//alert(appName);
	var  contSelect=document.getElementById("gfa_conts_list");	
	var contName = contSelect.value;
	//alert(contName);
	var  appPassInput=document.getElementById("app_pass");	
	var appPass = appPassInput.value;
	alert(devName + "---" + appName + "---" + appPass + "---" + contName);
	g_GfaSecAppObj.DelEccCont(devName, appName, appPass, contName);
}

/**
 * 复制内容到粘贴板
 * content : 需要复制的内容
 * message : 复制完后的提示，不传则默认提示"复制成功"
 */
function copyToClip(content, message) {
    var aux = document.createElement("input"); 
    aux.setAttribute("value", content); 
    document.body.appendChild(aux); 
    aux.select();
    document.execCommand("copy"); 
    document.body.removeChild(aux);
    if (message == null) {
        alert("复制成功.");
    } else{
        alert(message);
    }
}
function copy_cont_fun()
{
	var contSelect=document.getElementById("gfa_conts_list");	
	var contName = contSelect.value;
	//alert(contName);
	copyToClip(contName);
}
//创建主题DN
function create_subject_dn_fun() {
	var email = document.getElementById("email").value;
	var cn = document.getElementById("cn").value;
	var ou = document.getElementById("ou").value;
	var o = document.getElementById("o").value;
	var l = document.getElementById("l").value;
	var st = document.getElementById("st").value;
	var c = document.getElementById("c").value;
	alert(email + "---" + cn + "---" + ou + "---" + o + "---" + l + "---" + st + "---" + c);
	g_GfaSecAppObj.CreateSubjectDN(email, cn, ou, o, l, st, c);	
}

function reverse_dn_fun(){
		var dn = document.getElementById("subject_dn").value;
    //document.getElementById("subject_dn").value = dn.split('/').reverse().join('/');
    var dna = dn.split('/');
    var dn0 = dna.splice(0,1);
    dna.reverse().unshift(dn0);
    document.getElementById("subject_dn").value = dna.join('/');
}

/*
function transfer_dn_fun(){
		var dn = document.getElementById("subject_dn").value;
		var dna = dn.split(',');
		//dna.reverse().unshift("");
		dna.unshift("");
    document.getElementById("subject_dn").value = dna.join('/');
}
*/

function transfer_dn_fun(){
		var dn = document.getElementById("subject_dn").value;
		var dna = dn.split(',');
		//dna.reverse().unshift("");
		dna.unshift("");
		var dna_str = dna.join('/');
		var dna_str_replace = dna_str.replace(/c=/g,"C=");
    document.getElementById("subject_dn").value = dna_str_replace;
}

//创建ECC证书请求
function create_ecc_csr_fun() {
	var  devSelect=document.getElementById("gfa_devices_list");	
	var devName = devSelect.value;
	var  appSelect=document.getElementById("gfa_apps_list");	
	var appName = appSelect.value;
	var  appPassInput=document.getElementById("app_pass");	
	var appPass = appPassInput.value;
	var eccCont = document.getElementById("ecc_cont").value;
	var subjectDN = document.getElementById("subject_dn").value;
	alert(devName + "---" + appName + "---" + appPass + "---" + eccCont + "---" + subjectDN);
	g_GfaSecAppObj.CreateEccCsr(devName, appName, appPass, eccCont, subjectDN);
}

//创建RSA证书请求
function create_rsa_csr_fun() {
	var  devSelect=document.getElementById("gfa_devices_list");	
	var devName = devSelect.value;
	var  appSelect=document.getElementById("gfa_apps_list");	
	var appName = appSelect.value;
	var  appPassInput=document.getElementById("app_pass");	
	var appPass = appPassInput.value;
	var rsaCont = document.getElementById("rsa_cont").value;
	var subjectDN = document.getElementById("subject_dn").value;
	alert(devName + "---" + appName + "---" + appPass + "---" + rsaCont + "---" + subjectDN);
	g_GfaSecAppObj.CreateRsaCsr(devName, appName, appPass, rsaCont, subjectDN);
}

//解析P7B证书链
function parse_p7b_cert_chain_fun() {
	var p7bCertChain = document.getElementById("p7b_cert_chain").value;
	var subjectDN = document.getElementById("subject_dn").value;
	alert(p7bCertChain + "---" + subjectDN);
	g_GfaSecAppObj.ParseP7bCertChain(p7bCertChain, subjectDN);
}

//安装ECC签名证书
function install_ecc_sign_cert_fun() {
	var  devSelect=document.getElementById("gfa_devices_list");	
	var devName = devSelect.value;
	var  appSelect=document.getElementById("gfa_apps_list");	
	var appName = appSelect.value;
	var  appPassInput=document.getElementById("app_pass");	
	var appPass = appPassInput.value;
	var eccCont = document.getElementById("ecc_cont").value;
	var eccSignCert = document.getElementById("ecc_sign_cert").value;
	alert(devName + "---" + appName + "---" + appPass + "---" + eccCont + "---" + eccSignCert);
	g_GfaSecAppObj.InstallEccSignCert(devName, appName, appPass, eccCont, eccSignCert);
}

//删除证书ECC容器
function del_cert_ecc_cont_fun() {
	var  myselect=document.getElementById("gfa_certs_list");	
	var cert = g_GfaSecAppObj.certs[myselect.selectedIndex];
	var devName = cert.dev_name;
	var appName = cert.app_name;
	var eccCont = cert.kc;
	var appPass = document.getElementById("app_pass").value;
	alert(devName + "---" + appName + "---" + appPass + "---" + eccCont);
	g_GfaSecAppObj.DelEccCont(devName, appName, appPass, eccCont);
}

//更新ECC签名证书
function update_ecc_sign_cert_fun() {
	var isCheck = document.getElementById("is_key_pair_update").checked
	if(isCheck == true)
	{
		var myselect=document.getElementById("gfa_certs_list");	
		var cert = g_GfaSecAppObj.certs[myselect.selectedIndex];
		var devName = cert.dev_name;
		var appName = cert.app_name;
		var eccCont = cert.kc;
		var appPass = document.getElementById("app_pass").value;
		alert("delete old container:" + eccCont);
		g_GfaSecAppObj.DelEccCont(devName, appName, appPass, eccCont);
		
		eccCont = document.getElementById("ecc_cont").value;
		var eccSignCert = document.getElementById("ecc_sign_cert").value;
		alert("install new container:" + eccCont);
		g_GfaSecAppObj.InstallEccSignCert(devName, appName, appPass, eccCont, eccSignCert);
	}
	else
	{
		var devSelect=document.getElementById("gfa_devices_list");	
		var devName = devSelect.value;
		var  appSelect=document.getElementById("gfa_apps_list");	
		var appName = appSelect.value;
		var  appPassInput=document.getElementById("app_pass");	
		var appPass = appPassInput.value;
		var eccCont = document.getElementById("ecc_cont").value;
		var eccSignCert = document.getElementById("ecc_sign_cert").value;
		alert(devName + "---" + appName + "---" + appPass + "---" + eccCont + "---" + eccSignCert);
		g_GfaSecAppObj.InstallEccSignCert(devName, appName, appPass, eccCont, eccSignCert);
	}
}

//安装ECC加密证书
function install_ecc_enc_cert_fun() {
	var  devSelect=document.getElementById("gfa_devices_list");	
	var devName = devSelect.value;
	var  appSelect=document.getElementById("gfa_apps_list");	
	var appName = appSelect.value;
	var  appPassInput=document.getElementById("app_pass");	
	var appPass = appPassInput.value;
	var eccCont = document.getElementById("ecc_cont").value;
	var eccEncCert = document.getElementById("ecc_enc_cert").value;
	var privateKeyCiper = document.getElementById("private_key_ciper").value;
	alert(devName + "---" + appName + "---" + appPass + "---" + eccCont + "---" + eccEncCert + "---" + privateKeyCiper);
	g_GfaSecAppObj.InstallEccEncCert(devName, appName, appPass, eccCont, eccEncCert, privateKeyCiper);
}

//更新ECC加密证书
function update_ecc_enc_cert_fun() {
	var isCheck = document.getElementById("is_key_pair_update").checked
	if(isCheck == true)
	{
		var myselect=document.getElementById("gfa_certs_list");	
		var cert = g_GfaSecAppObj.certs[myselect.selectedIndex];
		var devName = cert.dev_name;
		var appName = cert.app_name;
		var eccCont = cert.kc;
		var appPass = document.getElementById("app_pass").value;
		alert("delete old container:" + eccCont);
		g_GfaSecAppObj.DelEccCont(devName, appName, appPass, eccCont);
		
		eccCont = document.getElementById("ecc_cont").value;
		var eccEncCert = document.getElementById("ecc_enc_cert").value;
		var privateKeyCiper = document.getElementById("private_key_ciper").value;
		alert("install new container:" + eccCont);
		g_GfaSecAppObj.InstallEccEncCert(devName, appName, appPass, eccCont, eccEncCert, privateKeyCiper);
	}
	else
	{
		var devSelect=document.getElementById("gfa_devices_list");	
		var devName = devSelect.value;
		var  appSelect=document.getElementById("gfa_apps_list");	
		var appName = appSelect.value;
		var  appPassInput=document.getElementById("app_pass");	
		var appPass = appPassInput.value;
		var eccCont = document.getElementById("ecc_cont").value;
		var eccEncCert = document.getElementById("ecc_enc_cert").value;
		var privateKeyCiper = document.getElementById("private_key_ciper").value;
		alert(devName + "---" + appName + "---" + appPass + "---" + eccCont + "---" + eccEncCert + "---" + privateKeyCiper);
		g_GfaSecAppObj.InstallEccEncCert(devName, appName, appPass, eccCont, eccEncCert, privateKeyCiper);
	}
}
</script>
</body>
</html>
